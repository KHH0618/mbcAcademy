DROP TABLE ORDER_DETAL;
DROP TABLE ORDERS;
DROP TABLE CART;
DROP TABLE PRODUCT;
DROP TABLE MEMBER;

CREATE TABLE MEMBER(
    mID VARCHAR2(50) PRIMARY KEY,
    mNAME VARCHAR2(50) NOT NULL,
    mTEL VARCHAR2(15) NOT NULL UNIQUE,
    mADDRESS VARCHAR(225),
    mMAIL VARCHAR2(225) NOT NULL UNIQUE
);

CREATE TABLE PRODUCT(
    pCORD VARCHAR2(5) PRIMARY KEY,
    pNAME VARCHAR2(50) NOT NULL,
    PRICE NUMBER(6) NOT NULL,
    pSTOCK NUMBER(3) NOT NULL CHECK(pSTOCK>=0)
);

CREATE TABLE ORDERS(
    oNO NUMBER(9) PRIMARY KEY,
    mID VARCHAR2(50) REFERENCES MEMBER(mID),
    oNAME VARCHAR2(50) NOT NULL,
    oTEL VARCHAR2(50) NOT NULL,
    oADDRESS VARCHAR2(50) NOT NULL,
    oDATE VARCHAR2(50) NOT NULL
);

CREATE TABLE CART(
    cNO NUMBER(5) PRIMARY KEY,
    mID VARCHAR2(50) REFERENCES MEMBER(mID),
    pCORD VARCHAR2(5) REFERENCES PRODUCT(pCORD),
    QTY NUMBER(5) NOT NULL,
    cCOST NUMBER(12) NOT NULL
);

CREATE TABLE ORDER_DETAL(
    odNO NUMBER(5) PRIMARY KEY,
    oNO NUMBER(9) REFERENCES ORDERS(oNO),
    pCORD VARCHAR2(5) REFERENCES PRODUCT(pCORD),
    QTY NUMBER(5) NOT NULL,
    cCOST NUMBER(12) NOT NULL
);

INSERT INTO MEMBER VALUES('abc', '홍길동', '010-9999-9999', '서울시 관악구', 'hong@hong.com');
INSERT INTO MEMBER VALUES('def', '김김동', '010-8888-8888', '경기도 수원시', 'kim@kim.com');

INSERT INTO PRODUCT VALUES ('A1', '맥주', 3000, 100);
INSERT INTO PRODUCT VALUES ('A2', '마스크', 200, 100);
INSERT INTO PRODUCT VALUES('B1', '땅콩', 3000, 100);
INSERT INTO PRODUCT VALUES('B2', '오징어', 5000, 100);
INSERT INTO PRODUCT VALUES('C1', '소독약', 7000, 100);

SELECT * FROM MEMBER;
SELECT * FROM PRODUCT;

DROP SEQUENCE ORDERS_oNO_SEQ;

CREATE SEQUENCE ORDERS_oNO_SEQ
    MAXVALUE 999
    NOCACHE
    NOCYCLE;
DROP SEQUENCE CART_cNO_SEQ;
CREATE SEQUENCE CART_cNO_SEQ
    MAXVALUE 999
    NOCACHE
    NOCYCLE;

DROP SEQUENCE ORDER_DETAL_odNO_SEQ;
CREATE SEQUENCE ORDER_DETAL_odNO_SEQ
    MAXVALUE 999
    NOCACHE
    NOCYCLE;  


INSERT INTO CART VALUES (TRIM(CART_cNO_SEQ.NEXTVAL), 'abc', 'A1', 3, (SELECT PRICE*3 FROM PRODUCT WHERE pCORD = 'A1'));
INSERT INTO ORDERS VALUES (TO_NUMBER(TO_CHAR(SYSDATE,'RRMMDD')||TRIM(TO_CHAR(ORDERS_oNO_SEQ.NEXTVAL,'000'))),
    'abc', '홍길동', '서울시 관악구', '010-9999-9999', TO_CHAR(SYSDATE,'YYYY"년" MM"월" DD"일"')
);
INSERT INTO ORDER_DETAL VALUES(TRIM(ORDER_DETAL_odNO_SEQ.NEXTVAL), 
    TO_NUMBER(TO_CHAR(SYSDATE,'RRMMDD')||TRIM(TO_CHAR(ORDERS_oNO_SEQ.CURRVAL,'000'))),'A1', 3, 9000);
DELETE FROM CART;

INSERT INTO CART VALUES (TRIM(CART_cNO_SEQ.NEXTVAL), 'def', 'B1', 1, (SELECT PRICE*1 FROM PRODUCT WHERE pCORD = 'B1'));
INSERT INTO ORDERS VALUES (TO_NUMBER(TO_CHAR(SYSDATE,'RRMMDD')||TRIM(TO_CHAR(ORDERS_oNO_SEQ.NEXTVAL,'000'))),
    'def', '김김동', '경기도 수원시', '010-8888-8888', TO_CHAR(SYSDATE,'YYYY"년" MM"월" DD"일"')
);
INSERT INTO ORDER_DETAL VALUES(TRIM(ORDER_DETAL_odNO_SEQ.NEXTVAL), 
    TO_NUMBER(TO_CHAR(SYSDATE,'RRMMDD')||TRIM(TO_CHAR(ORDERS_oNO_SEQ.CURRVAL,'000'))),'B1', 1, 3000);
DELETE FROM CART;

INSERT INTO CART VALUES (TRIM(CART_cNO_SEQ.NEXTVAL), 'abc', 'C1', 20, (SELECT PRICE*1 FROM PRODUCT WHERE pCORD = 'C1'));    
INSERT INTO ORDERS VALUES (TO_NUMBER(TO_CHAR(SYSDATE,'RRMMDD')||TRIM(TO_CHAR(ORDERS_oNO_SEQ.NEXTVAL,'000'))),
    'abc', '홍아빠', '제주도 제주시', '010-7777-9999', TO_CHAR(SYSDATE,'YYYY"년" MM"월" DD"일"')
);
INSERT INTO ORDER_DETAL VALUES(TRIM(ORDER_DETAL_odNO_SEQ.NEXTVAL), 
    TO_NUMBER(TO_CHAR(SYSDATE,'RRMMDD')||TRIM(TO_CHAR(ORDERS_oNO_SEQ.CURRVAL,'000'))),'C1', 20, (SELECT PRICE * 20 FROM PRODUCT WHERE pCORD = 'C1'));
DELETE FROM CART;  
SELECT * FROM ORDERS;
SELECT * FROM ORDER_DETAL;






